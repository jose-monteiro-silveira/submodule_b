<h1 class="title">Image <span>Optimization</span></h1>

<p>O Azion Image Optimization automatiza seu workflow de tratamento de imagens.</p>

<p>A otimização de suas imagens reduz o tamanho das mesmas, sem perda perceptível de qualidade visual, o que reduz o tempo transferência de seu conteúdo e melhora a experiência de usuário. Isso aumenta a fluidez de suas páginas e a velocidade de navegação, sem você precisar fazer praticamente nada.</p>

<p>Você automatiza seu workflow de tratamento de imagens, utilizando as funções para redimensionar, recortar ou aplicar filtros em suas imagens, sem a necessidade de gerenciar dezenas de versões e recortes de cada imagem em seu acervo.</p>

<ul class="orng-bar-list">
    <li><a href="#instrucoes-de-uso">1. Instruções de uso</a></li>
    <li><a href="#redimensionar-a-imagem-com-auto-crop">2. Redimensionar a imagem com auto-crop</a></li>
    <li><a href="#redimensionar-a-imagem-com-fit-in">3. Redimensionar a imagem com fit-in</a></li>
    <li><a href="#recortar-a-imagem">4. Recortar a imagem</a></li>
    <li><a href="#alterar-qualidade-da-imagem">5. Alterar qualidade da imagem</a></li>
    <li><a href="#adicionar-marca-dagua-na-imagem">6. Adicionar marca d’água na imagem</a></li>
    <li><a href="#converter-o-formato-de-uma-imagem">7. Converter o formato de uma imagem</a></li>
    <li><a href="#preencher-imagem">8. Preencher imagem</a></li>
    <li><a href="#combinar-filtros">9. Combinar filtros</a></li>
    <li><a href="#como-o-image-optimization-e-tarifado">10. Como o Image Optimization é tarifado</a></li>
</ul>  

<hr class="breaker">

<h2 class="black-small-title" id="instrucoes-de-uso" >1. Instruções de uso</h2>

<p>Desenvolvemos este produto para que você possa otimizar, redimensionar, recortar e aplicar filtros em suas imagens. Assim, proporcionamos mais velocidade e dinamismo à experiência de seu usuário.</p>

<p>Os formatos de imagem suportados são JPEG, GIF, PNG, BMP, ICO e WEBP (para <a href="https://caniuse.com/#search=webp" class="orng-link">browsers compatíveis</a>).</p>

<p class="black-sm-sub">Como configurar o Azion Image Optimization</p>

<p>Para configurar o Azion Image Optimization, siga as seguintes etapas, consultando as demais documentações técnicas, sempre que necessário:</p>

<p class="black-sm-sub">Etapa 1. Crie ou edite a configuração de Content Delivery para distribuição de suas imagens</p>

<ol>
    <li>Acesse o <a href="https://manager.azion.com/" class="orng-link">Real-Time Manager</a> e entre no menu Content Delivery</li>
    <li>Se você já tiver criado uma configuração de Content Delivery para distribuição de suas imagens, pule diretamente para a Etapa 2</li>
    <li>Caso contrário, crie uma configuração de Content Delivery para distribuição de suas imagens, seguindo a documentação de <a href="{% tl documentation_first_steps %}#crie-uma-nova-configuracao" class="orng-link">Primeiros Passos</a></li>
</ol>

<p class="black-sm-sub">Etapa 2. Habilite Advanced Cache Key para suas imagens</p>

<p class="blue-box">Para utilizar as funcionalidades de redimensionamento, recorte ou aplicação de filtros em imagens, você precisará configurar a variação de conteúdo por Query String</p>

<ol>
    <li>Edite a configuração de Content Delivery responsável pela distribuição de suas imagens, criada na Etapa 1</li>
    <li>Na aba Cache Settings, adicione ou edite uma política de cache customizada para suas imagens</li>
    <li>Atribua um nome sugestivo para sua política, você irá precisar dele na Etapa 3</li>
    <li>Na seção Expiration Settings, configure a política de expiração de suas imagens no cache, seguindo o que você aprendeu na documentação de Primeiros Passos; para imagens, a Azion recomenda que você utilize tempos mais longos como maximum TTL para CDN Cache, como por exemplo, 7.776.000 segundos (3 meses).</li>
    <li>Na seção Advanced Cache Key, selecione uma das opções:
        <ul  class="list-v">
            <li><em>Content varies by some Query String fields (Whitelist):</em> se você desejar listar todos os campos da Query String que diferenciam suas imagens. O Image Optimization utiliza o campo <em>ims</em>, que deverá ser incluído na listagem com os demais campos necessários por sua aplicação de gestão de imagens. Essa opção requer o produto Application Acceleration.</li>
            <li><em>Content varies by Query String, except for some fields (Blacklist):</em> se você desejar listar apenas quais campos da Query String devem ser ignorados ao diferenciar os objetos em cache. Nesse caso, garanta que o campo <em>ims</em> seja removido da listagem. Essa opção requer o produto Application Acceleration.</li>
            <li><em>Content varies by all Query String fields:</em> se você não sabe ou não se sente seguro para listar os campos da Query String que são responsáveis pela variação do seu conteúdo em cache, ou se não possui o produto Application Acceleration.</li>
        </ul>
    </li>
    <li>Nas demais seções, edite as configurações de acordo com sua necessidade e salve sua configuração de cache.</li>
</ol>

<p class="black-sm-sub">Etapa 3. Habilite o Image Optimization</p>

<ol>
    <li>Na aba Rules Engine, adicione ou edite uma regra customizada para um ou mais paths de imagens</li>
    <li>No campo Path, digite o caminho para suas imagens ou use a regex recomendada pela Azion <em>\.(jpg|jpeg|gif|png|bmp)$</em></li>
    <li>Marque o checkbox Regex, se estiver utilizando expressão regular no campo Path</li>
    <li>No campo Behavior, selecione Image Optimization</li>
    <li>No campo Cache Settings, selecione o preset criado na Etapa 2</li>
    <li>Em todas as demais seções, utilize as configurações adequadas para sua necessidade e salve a regra.</li>
</ol>

<p>A partir de agora, as imagens do path configurado serão automaticamente otimizadas. Além disso, o Image Optimization detecta o compatibilidade do browser com o formato WEBP e, quando possível, converte o formato da imagem automaticamente, trazendo ainda mais ganhos para você. Imagens BMP também serão automaticamente convertidas para JPEG ou WEBP, dependendo da compatibilidade do browser.</p>

<p>Se você tiver contratado o <a href="{% tl documentation_products_analytics %}" class="orng-link">Azion Analytics Premium</a>, acompanhe o gráfico de <em>Bandwidth Saving</em> para monitorar a economia de tráfego resultante da otimização.</p>

<p>Conheça, a seguir, as demais funcionalidades do produto, configuradas como argumentos na Query String da URL da imagem.</p>

<hr class="breaker">

<h2 class="black-small-title" id="redimensionar-a-imagem-com-auto-crop" >2. Redimensionar a imagem com auto-crop</h2>

<p>Você pode utilizar o Image Optimization da Azion para redimensionar suas imagens, sem a necessidade de ter que gerenciar múltiplos arquivos em seu acervo de imagens.</p>

<p>A partir de uma imagem original de seu acervo, o Image Optimization poderá criar imagens derivadas, sob demanda, do tamanho que melhor se adapte à sua página.</p>

<p>Você especifica as dimensões desejadas como argumentos na Query String, no formato:</p>

<div class="white-code">
{% highlight console %}
ims=WidthxHeight
{% endhighlight %}
</div>

<ul class="list-v">
    <li>Width: largura, em pixels, para a imagem derivada</li>
    <li>Height: altura, em pixels, para a imagem derivada</li>
</ul>

<p>Para redimensionar a imagem preservando o <em>aspect ratio</em>, omita um dos dois valores, o qual será calculado automaticamente. Utilize <em>Widthx</em> para especificar apenas a largura e deixar que a altura seja calculada proporcionalmente, ou <em>xHeight</em>, para especificar apenas a altura e deixar que a largura seja calculada automaticamente.</p>

<p>Você também pode especificar ambas as dimensões, <em>Width</em> e <em>Height</em>, para recortar (<em>auto-crop</em>) a imagem, nas dimensões desejadas. O recorte é centralizado e pode ocorrer tanto na vertical quanto na horizontal, dependendo do melhor encaixe das dimensões originais nas dimensões especificadas.</p>

<p>Utilize o valor <em>orig</em> em qualquer das dimensões da imagem, se desejar manter a dimensão original.</p>

<p class="black-sm-sub">Exemplos de aplicação</p>

<p><em>http://yourdomain.com/image.jpg?ims=880x</em> (880 pixels de largura, altura automática)</p>

<a href="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=880x" }}" target="_blank" rel="noopener"><img src="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=880x" }}" alt="ims=880x"></a>

<p><em>http://yourdomain.com/image.jpg?ims=880xorig</em> (880 pixels de largura, altura original)</p>

<a href="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=880xorig" | url_decode }}" target="_blank" rel="noopener"><img src="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=880xorig" | url_decode }}" alt="ims=880xorig"></a>

<p><em>http://yourdomain.com/image.jpg?ims=400x</em> (400 pixels de largura, altura automática)</p>

<a href="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=400x" }}" target="_blank" rel="noopener"><img src="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=400x" }}" alt="ims=400x"></a>

<p><em>http://yourdomain.com/image.jpg?ims=400x400</em> (400 pixels de largura, 400 pixels de altura)</p>

<a href="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=400x400" | url_decode}}" target="_blank" rel="noopener"><img src="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=400x400" | url_decode }}" alt="ims=400x400"></a>

<p><em>http://yourdomain.com/image.jpg?ims=x100</em> (largura automática, 100 pixels de altura)</p>

<a href="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=x100" | url_decode }}" target="_blank" rel="noopener"><img src="{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=x100" | url_decode}}" alt="x100"></a>

<hr class="breaker">

<h2 class="black-small-title" id="redimensionar-a-imagem-com-fit-in" >3. Redimensionar a imagem com fit-in</h2>

<p>Outra forma de redimensionar a imagem é utilizando fit-in:</p>

<div class="white-code">
{% highlight console %}
ims=fit-in/WidthxHeight
{% endhighlight %}
</div>

<ul class="list-v">
    <li>Width: largura máxima, em pixels, para a imagem derivada</li>
    <li>Height: altura máxima, em pixels, para a imagem derivada</li>
</ul>

<p>A imagem derivada será redimensionada para caber na área especificada por WidthxHeight. O aspect ratio da imagem original é preservado e, se desejar, você pode ocultar um dos valores.</p>

<p>Caso a área especificada seja maior do que as dimensões da imagem, a imagem não será aumentada. As dimensões especificadas como parâmetros do <em>fit-in</em> representam os limites de tamanho máximo da área que a imagem pode ocupar. Uma ou ambas as dimensões da imagem poderá ser menor do que a área delimitadora.</p>

<p class="black-sm-sub">Exemplo de aplicação</p>

<p><em>https://yourdomain.com/image.jpg?ims=fit-in/400x400</em> (largura máxima de 400 pixels e altura máxima de 400 pixels)</p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400" | url_decode }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400" | url_decode }}" alt="ims=fit-in/400x400"></a>

<hr class="breaker">

<h2 class="black-small-title" id="recortar-a-imagem" >4. Recortar a imagem</h2>

<p>O recorte da imagem pode ser feito informando um ponto inicial (AxB) e um ponto final (CxD), como argumento na Query String da URL da imagem:</p>

<div class="white-code">
{% highlight console %}
ims=AxB:CxD
{% endhighlight %}
</div>

<ul class="list-v">
    <li>AxB: ponto inicial do recorte indicando a posição, em pixels, do canto superior esquerdo da área a ser recortada.</li>
    <li>CxD: ponto final do recorte indicando a posição, em pixels, do canto inferior direito da área a ser recortada.</li>
</ul>

<p class="black-sm-sub">Exemplo de aplicação</p>

<p><em>http://yourdomain.com/image.jpg?ims=430x20:910x730</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=430x20:910x730" | url_decode }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=430x20:910x730" | url_decode }}" alt="ims=430x20:910x730"></a> 

<hr class="breaker">

<h2 class="black-small-title" id="alterar-qualidade-da-imagem" >5. Alterar qualidade da imagem</h2>

<p>O Image Optimization otimiza suas imagens, reduzindo o tamanho do arquivo e, portanto, o tempo de transferência do mesmo. O valor default de qualidade utilizado é de 85%, o que proporciona otimização sem perda perceptível de qualidade visual.</p>

<p>Se necessário, você pode definir uma qualidade customizada para suas imagens, utilizando o filtro:</p>

<div class="white-code">
{% highlight console %}
filters:quality(Number)
{% endhighlight %}
</div>

<p>Onde <em>Number</em> deve ser um número inteiro entre 0 e 100, que representa a qualidade desejada.</p>

<p class="black-sm-sub">Exemplo de aplicação</p>

<p><em>http://yourdomain.com/image.jpg?ims=filters:quality(100)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(100)" }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(100)" }}" alt="ims=filters:quality(100)"></a> 

<p><em>http://yourdomain.com/image.jpg?ims=filters:quality(85)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(85)" }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(85)" }}" alt="ims=filters:quality(85)"></a> 

<p><em>http://yourdomain.com/image.jpg?ims=filters:quality(15)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(15)" }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:quality(15)" }}" alt="ims=filters:quality(15)"></a> 

<hr class="breaker">

<h2 class="black-small-title" id="adicionar-marca-dagua-na-imagem" >6. Adicionar marca d’água na imagem</h2>

<p>Para adicionar marca d’água em imagens utilizando o Image Optimization, utilize o filtro:</p>

<div class="white-code">
{% highlight console %}
filters:watermark(ImageURL,X,Y,Alpha)
{% endhighlight %}
</div>

<ul class="list-v">
    <li>ImageURL: é a URL da imagem que deve ser inserida como marca d’água. Caso a URL contenha parênteses, eles devem ser codificados como %28 para “(” e %29 para “)”.</li>
    <li>X: posição horizontal de inserção da marca d’água. Números positivos representam deslocamento, em pixels, da borda à esquerda para a direita, enquanto números negativos reprentam deslocamento da borda à direita para a esquerda. Pode ser utilizado o valor center, para centralizar horizontalmente a marca d’água, ou o valor repeat, para preencher horizontalmente a imagem com repetições da marca d’água.</li>
    <li>Y: posição vertical de inserção da marca d’água. Números positivos representam um deslocamento, em pixels, do topo para a base, enquanto números negativos representam deslocamento da base para o topo. Pode ser utilizado o valor center, para centralizar verticalmente a marca d’água, ou o valor repeat,  para preencher verticalmente a imagem com repetições da marca d’água.</li>
    <li>Alpha: transparência da marca d’água. Deve ser um número entre 0 (completamente opaco) e 100 (completamente transparente).</li>
</ul>

<p class="black-sm-sub">Exemplo de aplicação</p>

<em>http://yourdomain.com/image.jpg?ims=filters:watermark(http://yourdomain.com/watermark-image.png,-25,-10,50)</em>

<hr class="breaker">

<h2 class="black-small-title" id="converter-o-formato-de-uma-imagem" >7. Converter o formato de uma imagem</h2>

<p>Você pode converter o formato de uma imagem utilizando o filtro:</p>

<div class="white-code">
{% highlight console %}
filters:format(ImageFormat)
{% endhighlight %}
</div>

<p>Onde ImageFormat pode assumir os valores webp, jpeg, gif ou png.</p>

<p class="black-sm-sub">Exemplo de aplicação</p>

<p>Para converter uma image jpeg para gif:</p>

<p><em>http://yourdomain.com/image.jpg?ims=filters:format(gif)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:format(gif)" }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=filters:format(gif)" }}" alt="ims=filters:format(gif)"></a> 

<hr class="breaker">

<h2 class="black-small-title" id="preencher-imagem" >8. Preencher imagem</h2>

<p>O Image Optimization também pode ser utilizado para gerar uma imagem derivada em um tamanho maior do que o da original, mas ao invés de redimensioná-la para o tamanho desejado, pode preencher o espaço com uma cor customizada. Utilize o parâmetro de <a href="#redimensionar-a-imagem-com-fit-in" class="orng-link">fit-in</a> com as dimensões desejadas associado com filtro <em>fill</em>:</p>

<div class="white-code">
{% highlight console %}
filters:fill(Color)
{% endhighlight %}
</div>
    
<p>Onde <em>Color</em> é a cor de preenchimento, seguindo a nomenclatura e códigos especificados para o <a href="https://en.wikipedia.org/wiki/Web_colors" class="orng-link dont-break">padrão HTML</a>.</p>

<p class="black-sm-sub">Exemplo de aplicação</p>

<p><em>http://yourdomain.com/image.jpg?ims=fit-in/400x400/filters:fill(gray)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(gray)" | url_decode }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(gray)" | url_decode }}" alt="ims=fit-in/400x400/filters:fill(gray)"></a> 

<p><em>http://yourdomain.com/image.jpg?ims=fit-in/400x400/filters:fill(008080)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(008080)" | url_decode }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(008080)" | url_decode }}" alt="ims=fit-in/400x400/filters:fill(008080)"></a> 

<p><em>http://yourdomain.com/image.jpg?ims=fit-in/400x400/filters:fill(00ffff)</em></p>

<a href="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(00ffff)" | url_decode }}" target="_blank" rel="noopener"><img src="{{ "{{ site.url }}/images/docs/image-optimization/bulldog-1280px.jpg?ims=fit-in/400x400/filters:fill(00ffff)" | url_decode }}" alt="ims=fit-in/400x400/filters:fill(00ffff)"></a> 

<hr class="breaker">

<h2 class="black-small-title" id="combinar-filtros" >9. Como o Image Optimization é tarifado</h2>

<p>O Image Optimization permite que você combine os filtros desejados separando os mesmos por “:”.</p>

<div class="white-code">
{% highlight console %}
filters:filter1(arg1):filter2(arg2)
{% endhighlight %}
</div>

<p>Onde filter1(arg1) e filter2(arg2) são os filtros que você deseja aplicar.</p>

<p class="black-sm-sub">Exemplo de aplicação</p>

<em>http://yourdomain.com/image.jpg?ims=fit-in/400x400/filters:fill(gray):quality(100)</em>

<hr class="breaker">

<h2 class="black-small-title" id="como-o-image-optimization-e-tarifado" >10. Como o Image Optimization é tarifado</h2>

<p>A cobrança do Azion Image Optimization é baseada no número de requisições de processamento de imagens.</p>

<p>As imagens podem ser processadas mais de uma vez, dependendo de fatores como:</p>

<ul class="list-v">
    <li>a quantidade de derivações solicitadas: recortes, redimensionamentos e aplicação de filtros</li>
    <li>o hit ratio das imagens no cache do Azion Content Delivery</li>
</ul>

<p>São contabilizadas tanto requisições HTTP quanto HTTPS, sem distinção de valor entre ambas.</p>

<p>A cobrança do Image Optimization é adicional a cobrança do Content Delivery, no entanto, a redução do tamanho das imagens traz economia no tráfego total de conteúdo pelo Content Delivery. Acompanhe o gráfico <em>Bandwidth Saving</em> para monitorar a economia.</p>

<p>Para reduzir seu consumo no Image Optimization, a Azion recomenda que você aumente o tempo de vida de suas imagens em cache (<em>hit ratio</em>), o que também resultará em maior economia de tráfego no Content Delivery.</p>

<hr class="breaker">

<p>
    Não encontrou o que procurava? <a href="https://tickets.azion.com/" class="orng-link dont-break">Abra um ticket.</a>
</p>